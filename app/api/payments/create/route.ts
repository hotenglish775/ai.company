import { NextRequest, NextResponse } from 'next/server';

// Types
interface Product {
  id: string;
  name: string;
  description: string;
  price: string;
  features: string[];
}

interface Customer {
  firstName: string;
  lastName: string;
  email: string;
  phone: string;
}

interface PaymentRequest {
  product: Product;
  customer: Customer;
  paymentMethod: 'stripe' | 'cryptomus';
}

// Mock database functions (replace with your actual database)
async function createOrder(orderData: any) {
  // This would save to your database
  console.log('Creating order:', orderData);
  return {
    id: `order_${Date.now()}`,
    ...orderData,
    status: 'pending',
    createdAt: new Date().toISOString(),
  };
}

// Stripe integration
async function createStripeCheckout(product: Product, customer: Customer, orderId: string) {
  const priceInCents = Math.round(parseFloat(product.price.replace(/[^0-9.]/g, '')) * 100);
  
  // In a real implementation, you would use the Stripe SDK
  const stripeData = {
    mode: 'subscription',
    line_items: [
      {
        price_data: {
          currency: 'usd',
          product_data: {
            name: product.name,
            description: product.description,
          },
          unit_amount: priceInCents,
          recurring: {
            interval: 'month',
          },
        },
        quantity: 1,
      },
    ],
    customer_email: customer.email,
    metadata: {
      orderId,
      productId: product.id,
      customerName: `${customer.firstName} ${customer.lastName}`,
      customerPhone: customer.phone,
    },
    success_url: `${process.env.NEXT_PUBLIC_BASE_URL}/payment/success?session_id={CHECKOUT_SESSION_ID}`,
    cancel_url: `${process.env.NEXT_PUBLIC_BASE_URL}/payment/cancelled`,
  };

  // Mock Stripe response (replace with actual Stripe API call)
  return {
    id: `cs_${Date.now()}`,
    url: `https://checkout.stripe.com/pay/cs_${Date.now()}#fidkdWxOYHwnPyd1blpxYHZxWjA0VGxKfHFgaUpmS2ZKNkpMNTVKYjVhYjVKNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJLNjJL`,
  };

  // Mock Cryptomus response (replace with actual Cryptomus API call)
  return {
    uuid: `crypto_${Date.now()}`,
    url: `https://pay.cryptomus.com/pay/${Date.now()}`,
    qr_code: `data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==`,
  };
}

// Cryptomus integration
async function createCryptomusPayment(product: Product, customer: Customer, orderId: string) {
  const priceInUSD = parseFloat(product.price.replace(/[^0-9.]/g, ''));
  
  const cryptomusData = {
    amount: priceInUSD.toString(),
    currency: 'USD',
    order_id: orderId,
    url_return: `${process.env.NEXT_PUBLIC_BASE_URL}/payment/success`,
    url_callback: `${process.env.NEXT_PUBLIC_BASE_URL}/api/webhooks/cryptomus`,
    is_payment_multiple: false,
    lifetime: 7200, // 2 hours
    to_currency: 'USDT',
    additional_data: JSON.stringify({
      productId: product.id,
      customerName: `${customer.firstName} ${customer.lastName}`,
      customerEmail: customer.email,
      customerPhone: customer.phone,
    }),
  };

  // Mock Cryptomus response (replace with actual Cryptomus API call)
  return createCryptomusCheckout(product, customer, orderId);
}

export async function POST(request: NextRequest) {
  try {
    const body: PaymentRequest = await request.json();
    const { product, customer, paymentMethod } = body;

    // Validate input
    if (!product || !customer || !paymentMethod) {
      return NextResponse.json(
        { success: false, error: 'Missing required fields' },
        { status: 400 }
      );
    }

    // Create order in database
    const order = await createOrder({
      productId: product.id,
      productName: product.name,
      productPrice: product.price,
      customerFirstName: customer.firstName,
      customerLastName: customer.lastName,
      customerEmail: customer.email,
      customerPhone: customer.phone,
      paymentMethod,
      status: 'pending',
    });

    if (paymentMethod === 'stripe') {
      const stripeSession = await createStripeCheckout(product, customer, order.id);
      
      return NextResponse.json({
        success: true,
        checkoutUrl: stripeSession.url,
        sessionId: stripeSession.id,
        orderId: order.id,
      });
    } else if (paymentMethod === 'cryptomus') {
      const cryptomusPayment = await createCryptomusPayment(product, customer, order.id);
      
      return NextResponse.json({
        success: true,
        paymentUrl: cryptomusPayment.url,
        paymentId: cryptomusPayment.uuid,
        orderId: order.id,
        qrCode: cryptomusPayment.qr_code,
      });
    } else {
      return NextResponse.json(
        { success: false, error: 'Invalid payment method' },
        { status: 400 }
      );
    }
  } catch (error) {
    console.error('Payment creation error:', error);
    return NextResponse.json(
      { success: false, error: 'Internal server error' },
      { status: 500 }
    );
  }
}